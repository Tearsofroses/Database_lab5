% ==========================================
\section{Procedure (d) - Print Employee Details}
% ==========================================

\textbf{Exercise:} Create a stored procedure that prints SSN, Full name, Department name, and annual salary of all employees.

\textbf{Solution:}

\begin{lstlisting}
DROP PROCEDURE IF EXISTS PrintEmployeeDetails;
DELIMITER //
CREATE PROCEDURE PrintEmployeeDetails()
BEGIN
    DECLARE done INT DEFAULT FALSE;
    DECLARE v_ssn CHAR(9);
    DECLARE v_fullname VARCHAR(50);
    DECLARE v_dname VARCHAR(25);
    DECLARE v_annual_salary DECIMAL(12, 2);
    
    DECLARE emp_cursor CURSOR FOR
        SELECT 
            e.Ssn,
            CONCAT(e.Fname, ' ', e.Minit, ' ', e.Lname) AS Full_Name,
            d.Dname,
            e.Salary * 12 AS Annual_Salary
        FROM EMPLOYEE e
        LEFT JOIN DEPARTMENT d ON e.Dno = d.Dnumber;
    
    DECLARE CONTINUE HANDLER FOR NOT FOUND SET done = TRUE;
    
    DROP TEMPORARY TABLE IF EXISTS temp_employee_details;
    CREATE TEMPORARY TABLE temp_employee_details (
        SSN CHAR(9),
        Full_Name VARCHAR(50),
        Department_Name VARCHAR(25),
        Annual_Salary DECIMAL(12, 2)
    );
    
    OPEN emp_cursor;
    
    read_loop: LOOP
        FETCH emp_cursor INTO v_ssn, v_fullname, v_dname, v_annual_salary;
        IF done THEN
            LEAVE read_loop;
        END IF;
        INSERT INTO temp_employee_details 
        VALUES (v_ssn, v_fullname, v_dname, v_annual_salary);
    END LOOP;
    
    CLOSE emp_cursor;
    SELECT * FROM temp_employee_details;
    DROP TEMPORARY TABLE IF EXISTS temp_employee_details;
END //
DELIMITER ;
\end{lstlisting}

\subsubsection*{Test Validation}
\begin{lstlisting}
-- Call the procedure
CALL PrintEmployeeDetails();
\end{lstlisting}

\textbf{Expected Output:}
\begin{center}
\footnotesize
\begin{tabular}{|l|l|l|r|}
\hline
\textbf{SSN} & \textbf{Full\_Name} & \textbf{Dept\_Name} & \textbf{Annual\_Salary} \\
\hline
123456789 & John B Smith & Research & 360000.00 \\
333445555 & Franklin T Wong & Research & 480000.00 \\
999887777 & Alicia J Zelaya & Administration & 300000.00 \\
987654321 & Jennifer S Wallace & Administration & 516000.00 \\
666884444 & Ramesh K Narayan & Research & 456000.00 \\
453453453 & Joyce A English & Research & 300000.00 \\
987987987 & Ahmad V Jabbar & Research & 300000.00 \\
888665555 & James E Borg & Headquarters & 660000.00 \\
\hline
\end{tabular}
\end{center}
